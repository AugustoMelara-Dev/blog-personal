---
import BaseLayout from "../layouts/BaseLayout.astro";
import PostCard from "../components/PostCard.astro";
import AnimatedPost from "../components/AnimatedPost.tsx";
import SocialProof from "../components/SocialProof.tsx";
import { getCollection } from "astro:content";
import readingTime from "reading-time";

const allPosts = (await getCollection("posts"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const allFrases = await getCollection("frases");

const featuredPost = allPosts.find((post) => post.data.featured);
const latestPosts = allPosts
  .filter((post) => post !== featuredPost)
  .slice(0, 5);
---

<BaseLayout>
  <div class="w-full max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Hero -->
    <section class="pt-24 pb-16 md:pt-32 md:pb-24">
      <AnimatedPost client:load index={0}>
        <div class="flex items-center gap-4 mb-8">
          <div class="w-5 h-[2px] bg-lime-400"></div>
          <p
            class="text-xs text-[#525252] uppercase tracking-[0.3em] font-medium hero-subtitle"
          >
            Reflexiones · Poder · Biblia
          </p>
        </div>

        <h1
          class="text-[clamp(2.5rem,8vw,6rem)] leading-[1.1] tracking-tight mb-8 md:mb-12 hero-title"
        >
          <span class="block text-[#525252] font-light">Ideas que</span>
          <span class="block text-[#f5f5f5] font-bold">no se callan.</span>
        </h1>

        <div class="w-full h-px bg-[#1f1f1f] my-12"></div>

        <SocialProof
          client:load
          fallbackPosts={allPosts.length}
          fallbackFrases={allFrases.length}
        />
      </AnimatedPost>
    </section>

    <!-- Featured -->
    {
      featuredPost && (
        <section class="pb-16">
          <AnimatedPost client:load index={2}>
            <span class="inline-block text-xs font-medium uppercase tracking-widest text-accent mb-4">
              Destacado
            </span>
            <PostCard
              title={featuredPost.data.title}
              description={featuredPost.data.description}
              pubDate={featuredPost.data.pubDate}
              tags={featuredPost.data.tags}
              readingTime={readingTime(featuredPost.body || "").text.replace(
                "read",
                "lectura",
              )}
              slug={featuredPost.slug}
              featured={true}
            />
          </AnimatedPost>
        </section>
      )
    }

    <!-- Latest -->
    <section class="pb-24">
      <h2
        class="text-sm font-medium uppercase tracking-widest text-text-muted mb-8"
      >
        Últimas entradas
      </h2>
      <div class="flex flex-col gap-4">
        {
          latestPosts.map((post, i) => (
            <AnimatedPost client:load index={i + 3}>
              <PostCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                tags={post.data.tags}
                readingTime={readingTime(post.body || "").text.replace(
                  "read",
                  "lectura",
                )}
                slug={post.slug}
              />
            </AnimatedPost>
          ))
        }
      </div>
    </section>
  </div>
</BaseLayout>
